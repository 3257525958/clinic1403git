{% load static %}
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>لیست گفتگوها - کلینیک زیبایی دکتر اسدپور</title>
  <link rel="stylesheet" href="{% static 'css/new_addcontact.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* استایل‌های مخصوص صفحه لیست چت‌ها */
    .chat-list-wrapper {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 20px;
      background: #f5f5f5;
    }
    .chat-list-card {
      max-width: 600px;
      width: 100%;
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .chat-list-header {
      background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
    }
    .chat-list-header i {
      margin-left: 10px;
    }
    .chat-items {
      max-height: 70vh;
      overflow-y: auto;
    }
    .chat-item {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      border-bottom: 1px solid #f0f0f0;
      cursor: pointer;
      transition: background 0.2s;
      text-decoration: none;
      color: inherit;
    }
    .chat-item:hover {
      background: #f9f9f9;
    }
    .chat-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: bold;
      margin-left: 15px;
      flex-shrink: 0;
    }
    .chat-info {
      flex: 1;
      min-width: 0; /* برای جلوگیری از سرریز متن */
    }
    .chat-name {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .chat-last-message {
      font-size: 14px;
      color: #666;
      display: flex;
      align-items: center;
      gap: 5px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .chat-last-message i {
      font-size: 12px;
      flex-shrink: 0;
    }
    .incoming-indicator {
      color: #25D366; /* سبز */
    }
    .outgoing-indicator {
      color: #34B7F1; /* آبی */
    }
    .chat-time {
      font-size: 12px;
      color: #999;
      white-space: nowrap;
      margin-right: 10px;
      flex-shrink: 0;
    }
    .no-chat {
      text-align: center;
      padding: 40px;
      color: #999;
    }
    .no-chat i {
      font-size: 48px;
      color: #ddd;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
<div class="chat-list-wrapper">
  <div class="chat-list-card">
    <div class="chat-list-header">
      <i class="fas fa-comments"></i> گفتگوها
    </div>
    <div class="chat-items">
      {% for item in chat_list %}
        <a href="{% url 'sms_app:chat' item.contact.id %}" class="chat-item">
          <div class="chat-avatar">
            {{ item.contact.firstname|first|default:'?' }}
          </div>
          <div class="chat-info">
            <div class="chat-name">
              {{ item.contact.firstname }} {{ item.contact.lastname }}
              <small style="color:#999; font-size:12px;">{{ item.contact.phonnumber }}</small>
            </div>
            <div class="chat-last-message">
              {% if item.last_direction == 'outgoing' %}
                <i class="fas fa-check outgoing-indicator" title="ارسال شده"></i>
              {% elif item.last_direction == 'incoming' %}
                <i class="fas fa-reply incoming-indicator" title="دریافتی"></i>
              {% endif %}
              {{ item.last_message|truncatechars:40 }}
            </div>
          </div>
          <div class="chat-time">
            {% if item.last_time %}
              {{ item.last_time|date:"Y/m/d H:i" }}
            {% endif %}
          </div>
        </a>
      {% empty %}
        <div class="no-chat">
          <i class="fas fa-inbox"></i>
          <p>هیچ مخاطبی یافت نشد.</p>
        </div>
      {% endfor %}
    </div>
  </div>
</div>
</body>
</html>